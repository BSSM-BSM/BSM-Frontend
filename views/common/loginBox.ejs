<script>
    function login(){
        $.ajax({
            type:'POST',
            data:{
                member_id:$('.login .member_id').val(),
                member_pw:$('.login .member_pw').val(),
            },
            url:apiUrl+'/account/login',
            cache:false,
            success:function(data){
                data=JSON.parse(data);
                if(data.status!=1){
                    error_code(data.status, data.subStatus);
                }else{
                    if(refresh){
                        window.location.reload()
                    }else{
                        alert("로그인에 성공하였습니다.");
                        $('.login_box').trigger('removeClass');
                    }
                }
            },
            error:function(data) {
                error_code(0, 0);
            }
        });
    }
    function signUp(){
        $.ajax({
            type:'POST',
            data:{
                member_id:$('.sign_up .member_id').val(),
                member_pw:$('.sign_up .member_pw').val(),
                member_pw_check:$('.sign_up .member_pw_check').val(),
                member_nickname:$('.sign_up .member_nickname').val(),
                code:$('.sign_up .code').val(),
            },
            url:apiUrl+'/account/signUp',
            cache:false,
            success:function(data){
                data=JSON.parse(data);
                if(data.status!=1){
                    error_code(data.status, data.subStatus);
                }else{
                    alert("회원가입이 완료되었습니다.\n다시 로그인 해주세요.");
                    $('.sign_up_box').trigger('removeClass');
                }
            },
            error:function(data) {
                error_code(0, 0);
            }
        });
    }
    const pwEdit = () => {
        $.ajax({
            type:'POST',
            data:{
                member_pw:$('.pw_reset .member_pw').val(),
                member_pw_check:$('.pw_reset .member_pw_check').val(),
            },
            url:apiUrl+'/account/pwEdit',
            cache:false,
            success:data => {
                data=JSON.parse(data);
                if(data.status!=1){
                    error_code(data.status, data.subStatus);
                }else{
                    alert("비밀번호 재설정이 완료되었습니다.\n다시 로그인 해주세요.");
                    $('.pw_reset_box').trigger('removeClass');
                    $('.login_box').trigger('addClass');
                }
            },
            error:data => {
                error_code(0, 0);
            }
        });
    }
    const validCode = () => {
        $.ajax({
            type:'POST',
            data:{
                student_enrolled:$('.valid_code .studentEnrolled').val(),
                student_grade:$('.valid_code .studentGrade').val(),
                student_class:$('.valid_code .studentClass').val(),
                student_no:$('.valid_code .studentNo').val(),
                student_name:$('.valid_code .studentName').val(),
            },
            url:apiUrl+'/account/validCode',
            cache:false,
            success:data => {
                data=JSON.parse(data);
                if(data.status!=1){
                    error_code(data.status, data.subStatus);
                }else{
                    alert("인증코드 전송이 완료되었습니다.\n메일함을 확인해주세요.");
                    $('.valid_code_box').trigger('removeClass');
                }
            },
            error: () => {
                error_code(0, 0);
            }
        });
    }
</script>
<div class="login_box popup center">
    <div class="popup_close_button x_button" onClick="$('.login_box').trigger('removeClass');"></div>
    <div class="logo"><img src="/icons/logo.png" alt="로고"></div>
    <h2>로그인</h2>
    <form class="login" method="post" autocomplete="off" onsubmit="login();return false;">
        <input type="text" class="input_text member_id" placeholder="아이디" required autofocus>
        <input type="password" class="input_text member_pw" placeholder="비밀번호" required>
        <a onClick="$('.sign_up_box').trigger('addClass');">계정이 없으신가요? 회원가입</a>
        <button type="submit" class="main_button button">로그인</button>
    </form>
</div>
<div class="sign_up_box popup center">
    <div class="popup_close_button x_button" onClick="$('.sign_up_box').trigger('removeClass');"></div>
    <div class="logo"><img src="/icons/logo.png" alt="로고"></div>
    <h2>회원가입</h2>
    <form class="sign_up" method="post" autocomplete="off" onsubmit="signUp();return false;">
        <input type="text" class="input_text member_id" placeholder="아이디" required autofocus>
        <input type="password" class="input_text member_pw" placeholder="비밀번호" required>
        <input type="password" class="input_text member_pw_check" placeholder="비밀번호 재입력" required>
        <input type="text" class="input_text member_nickname" placeholder="닉네임" required>
        <input type="text" class="input_text code" placeholder="인증코드" required autofocus>
        <a onClick="$('.valid_code_box').trigger('addClass');">인증코드 발급</a>
        <button type="submit" class="main_button button">가입하기</button>
    </form>
</div>
<div class="pw_reset_box popup center">
    <div class="popup_close_button x_button" onClick="$('.pw_reset_box').trigger('removeClass');"></div>
    <h2>비밀번호 재설정</h2>
    <form class="pw_reset" method="post" autocomplete="off" onsubmit="pwEdit();return false;">
        <input type="password" class="input_text member_pw" placeholder="재설정할 비밀번호" required>
        <input type="password" class="input_text member_pw_check" placeholder="재설정할 비밀번호 재입력" required>
        <button type="submit" class="main_button button">비밀번호 재설정</button>
    </form>
</div>
<div class="valid_code_box popup center">
    <div class="popup_close_button x_button" onClick="$('.valid_code_box').trigger('removeClass');"></div>
    <h2>인증코드 발급</h2>
    <p>인증코드는 학교 이메일계정으로 보내드립니다.</p>
    <form class="valid_code" method="post" autocomplete="off" onsubmit="validCode();return false;">
        <input type="number" class="input_text studentEnrolled" placeholder="입학년도" min="2021" max="2099" required>  
        <input type="number" class="input_text studentGrade" placeholder="학년" min="1" max="3" required>
        <input type="number" class="input_text studentClass" placeholder="반" min="1" max="4" required>
        <input type="number" class="input_text studentNo" placeholder="번호" min="1" max="16" required>
        <br>
        <input type="text" class="input_text studentName" placeholder="이름" required>
        <button type="submit" class="main_button button">인증코드 발급</button>
    </form>
</div>