<!DOCTYPE HTML>
<html lang="kr">
<head>
    <link rel="stylesheet" type="text/css" href="/css/etc/board.css">
    <%- include('../common/head') %>
    <% switch(boardType){
        case 'board': %>
        <title>자유게시판 - BSM</title> %>
        <meta property="title" content="자유게시판 - BSM | 부산소마고 지원 서비스">
        <meta property="og:title" content="자유게시판 - BSM | 부산소마고 지원 서비스">
        <% break;
    case 'anonymous': %>
        <title>익명게시판 - BSM</title> %>
        <meta property="title" content="익명게시판 - BSM | 부산소마고 지원 서비스">
        <meta property="og:title" content="익명게시판 - BSM | 부산소마고 지원 서비스">
        <% break;
    } %>
    <script>
        const boardType = window.location.pathname.split('/')[2];
        const postNo = window.location.pathname.split('/')[3];
    </script>
</head>
<body>
    <%- include('../common/header') %>
    <main>
        <div class="title board_title">
            <div class="container">
            <% switch(boardType){
                case 'board': %>
                <h1>자유게시판</h1>
                <a href="/board/anonymous">익명게시판</a>
                <% break;
            case 'anonymous': %>
                <h1>익명게시판</h1>
                <a href="/board/board">자유게시판</a>
                <% break;
            } %>
                <br>
            </div>
        </div>
        <div class="container">
            <div class="board">
            <% if(postNo!=null){ %>
                <div class="post">
                    <div class="post_info_wrap">
                        <div class="left_wrap"><img :src="memberProfileUrl" onerror="this.src='/resource/member/profile_images/profile_default.png'" alt="" class="user_profile"></div>
                        <div class="right_wrap">
                            <div class="post_title">{{postTitle}}</div>
                            <div class="post_date">{{postDate}}</div>
                            <div class="post_hit">{{postHit}}</div>
                            <div class="post_comments">{{postComments}}</div>
                            <div class="member_nickname"><a :href="memberInfoUrl">{{memberNickname}}</a></div>
                            </div>
                        </div>
                    <div class="post_content"><div v-html="postContent"></div></div>
                    <div class="post_like_wrap post_like">
                        <button class="button like_button" onclick="likeSend(1);" v-bind:class="{on:like>0}">좋아요</button>
                        <span class="post_like_cnt">{{postLike}}</span>
                        <button class="button dislike_button" onclick="likeSend(-1);" v-bind:class="{on:like<0}">싫어요</button>
                    </div>
                </div>
                <div class="comment_list">
                    <div class="comment"></div>
                </div>
                <form class="comment_write" method="post" autocomplete="off" onsubmit="comment_write();return false;">
                    <textarea placeholder="댓글" class="post_comment" style="width:100%;height:10rem;" required></textarea>
                    <br><br>
                    <div class="button" onclick="commentRefresh();">댓글 새로고침</div>
                    <input type="submit" name="" value="댓글작성" class="button">
                </form>
                <div class="post_menu">
                    <span class="post_delete"></span>
                    <span class="post_modify"></span>
                </div>
                <script src="/js/board/post.js"></script>
                <script>
                    postRefresh();
                </script>
            <% } %>
                <div class=board_list>
                    <div class="board_type">
                    </div>
                    <div class="table_main"></div>
                    <script>
                        const boardRefresh = () => {
                            $.ajax({
                                type:'GET',
                                url:apiUrl+'/board/<%= boardType %><% if(page!=null) %>?page=<%= page %>',
                                cache:false,
                                success:(data)=>{
                                    data=JSON.parse(data);
                                    if(data.status!=1){
                                        error_code(data.status, data.subStatus);
                                    }else{
                                        let date = new Date()
                                        let today = ""+date.getFullYear()
                                        if((date.getMonth()+1)<10){
                                            today+='0'
                                        }
                                        today+=(date.getMonth()+1)
                                        if(date.getDate()<10){
                                            today+='0'
                                        }
                                        today+=date.getDate()
                                        boardData=data.arrBoard;
                                        boards = "";
                                        for(let i=0;i<Object.keys(boardData).length;i++){
                                            let board = "";
                                            board += '<div class="board_item left_wrap">'
                                                if(boardData[i].postComments>=1){
                                                    board += '<span class="post_comments active">'+boardData[i].postComments+ '</span>'
                                                }else{
                                                    board += '<span class="post_comments">'+boardData[i].postComments+ '</span>'
                                                }
                                            board += '</div>'
                                            board += '<div class="board_item right_wrap">'
                                                board += '<div class="board_item top_wrap">'
                                                    board += '<a href="/board/' +boardData[i].boardType+ '/' +boardData[i].postNo+ '<% if(page!=null){ %>?page=<%= page %><%}%>"class="post_title">' +boardData[i].postTitle+'</a>';
                                                board += '</div>'
                                                board += '<div class="board_item bottom_wrap">'
                                                    board += '<div class="board_item_info left_wrap">'
                                                        board += `<span class="member_info"><img src="/resource/member/profile_images/profile_`+boardData[i].memberCode+`.png" onerror="this.src='/resource/member/profile_images/profile_default.png'" alt="" class="user_profile"><a href="/memberinfo/`+boardData[i].memberCode+`">`+memberLevel[boardData[i].memberLevel]+boardData[i].memberNickname+`</a></span>`;
                                                    board += '</div>'
                                                    board += '<div class="board_item_info right_wrap">'
                                                    if(boardData[i].postLike>=1){
                                                        board += '<span class="board_item_post_info like active">'+boardData[i].postLike+'</span>';
                                                    }else if(boardData[i].postLike<0){
                                                        board += '<span class="board_item_post_info like">'+boardData[i].postLike+'</span>';
                                                    }
                                                    board += '<span class="board_item_post_info hit">'+boardData[i].postHit+'</span>';
                                                    if(boardData[i].postDate.split(' ')[0].replaceAll("-","")==today)
                                                        board += '<span class="board_item_post_info date">'+boardData[i].postDate.split(' ')[1]+'</span>';
                                                    else
                                                        board += '<span class="board_item_post_info date">'+boardData[i].postDate.split(' ')[0]+'</span>';
                                                    board += '</div>'
                                                board += '</div>'
                                            board += '</div>'
                                            boards += '<span class="board_item_wrap">'+board+'</span>';
                                        }
                                        $('.board_list .table_main').html(boards);
                                        //$('.page_num').html(data.pageNum);
                                    }
                                },
                                error:data => {
                                    error_code(0, 0);
                                }
                            });
                        }
                        boardRefresh();
                    </script>
                </div>
                <div class="board_bottom_menu">
                    <div class="board_menu_item board_refresh_button">
                        <button onClick="boardRefresh();" class="button">글 새로고침</button>
                    </div>
                    <div class="board_menu_item page_num"></div>
                    <div class="board_menu_item post_write_button">
                        <% if(member.isLogin){ %>
                            <a href="/board/write/<%= boardType %>" class="button blue_button">글쓰기</a>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <%- include('../common/loginBox') %>
</body>
</html>