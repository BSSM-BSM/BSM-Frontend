<!DOCTYPE HTML>
<html lang="kr">
<head>
    <link rel="stylesheet" type="text/css" href="/css/etc/board.css">
    <%- include('../common/head') %>
    <title>글쓰기 - BSM</title>
    <meta property="title" content="글쓰기 - BSM | 부산소마고 지원 서비스">
    <meta property="og:title" content="글쓰기 - BSM | 부산소마고 지원 서비스">
    <!-- summernote 라이브러리가 Jquery를 사용해서 어쩔 수 없이 사용함 -->
    <script src="/js/lib/jquery.min.js"></script>
    <link rel="stylesheet" href="/css/lib/summernote-lite.min.css">
    <script src="/js/lib/summernote-lite.min.js"></script>
    <script src="/js/lib/lang/summernote-ko-KR.js"></script>
</head>
<body>
    <%- include('../common/header') %>
    <script>
        refresh = false
    </script>
    <main>
        <div class="title">
            <h1>글쓰기</h1>
            <% switch(boardType){
                case 'board': %>
                <h2>자유게시판</h2>
                <% break
            case 'anonymous': %>
                <h2>익명게시판</h2>
                <% break
            } %>
            <br>
        </div>
        <div class="container">
            <script>
                window.addEventListener('DOMContentLoaded', () => {
                    jQuery('#summernote').summernote({
                        height : 480,
                        maxHeight : null,
                        minHeight : 480,
                        lang : 'ko-KR',
                        callbacks: {
                            onImageUpload:function(files, editor, welEditable){
                                for(let i = files.length - 1;i>=0;i--){
                                    sendFile(files[i], this);
                                }
                            }
                        },
                        disableResizeEditor: true,
                        toolbar: [
                            ['fontname', ['fontname']],
                            ['fontsize', ['fontsize']],
                            ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
                            ['color', ['forecolor','color']],
                            ['table', ['table']],
                            ['para', ['ul', 'ol', 'paragraph']],
                            ['height', ['height']],
                            ['insert',['picture','link','video']],
                            ['view', ['fullscreen', 'codeview', 'help']]
                            ],
                        fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','맑은 고딕','궁서','굴림체','굴림','돋움체','바탕체'],
                        fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72']
                    });
                })
                function sendFile(file, el, welEditable){
                    let files = new FormData();
                    files.append('file', file);
                    ajax({
                        method:'post',
                        payload:files,
                        url:'/imageUpload',
                        callBack:data=>{
                            jQuery(el).summernote('editor.insertImage', data.filePath);
                        }
                    })
                }
            </script>
            <form class="post_write" method="post" autocomplete="off" onsubmit="writePost();return false;">
                <% if(postNo!=null){ %>
                    <script>
                    const loadPost = () => {
                        ajax({
                            method:'get',
                            url:'/post/<%= boardType %>/<%= postNo %>',
                            callBack:data=>{
                                $$('input[name=post_title]')[0].value = data.postTitle;
                                jQuery('#summernote').summernote('code', data.postContent);
                            }
                        })
                    }
                    loadPost();
                    </script>
                <% } %>
                <input type="text" name="post_title" placeholder="제목" class="input_text" style="width:100%;" required autofocus>
                <textarea name="post_content" placeholder="내용" id="summernote" class="input_text" style="width:100%;" required></textarea>
                <br><br>
                <a href="/board/<%= boardType %>" class="button"><% switch(boardType){ case 'board': %>자유게시판<% break; case 'anonymous': %>익명게시판<% break; } %></a>
                <input type="submit" value="글작성" class="button">
            </form>
            <% if(postNo==null){ %>
                <script>
                    const writeType='post'
                </script>
            <% }else{ %>
                <script>
                    const writeType='put'
                </script>
            <% } %>
            <script>
                const writePost = () => {
                    ajax({
                        method:writeType,
                        url:'/post/<%= boardType %><% if(postNo!=null) %>/<%= postNo %>',
                        payload:{
                            postTitle:$$('input[name=post_title]')[0].value,
                            postContent:$$('textarea[name=post_content]')[0].value,
                        },
                        callBack:()=>{
                            window.location.href="/board/<%= boardType %>";
                        }
                    })
                }
            </script>
            <br>
        </div>
    </main>
    <%- include('../common/loginBox') %>
</body>
</html>